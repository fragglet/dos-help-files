<html>

<head>
<title>DISK.C - qc.hlp</title>
<link rel="stylesheet" href="../style.css">
<link rel="shortcut icon" href="../helpicon.png">
</head>

<body>
<div class="page-heading">
<form action="https://www.google.com/search" method="GET">
<input name="as_q" id="search-box" placeholder="Search">
<input type="hidden" name="as_sitesearch" value="fragglet.github.io/dos-help-files/*">
</form>
qc.hlp (<a href='index.html'>Table of Contents</a>; <a href='TOPIC_LIST.html'>Topic list</a>)</div>
<div class="page-title"> DISK.C</div>
<pre>                                             <span class='grhilite'>◄</span><a href='lib_dot_lst.html'>Up</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='index.html'>Contents</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='h_dot_index.html'>Index</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='javascript:history.back();'>Back</a><span class='grhilite'>►</span>
────────────────────────────────────────────────────────────────────────────
 
/* DISK.C illustrates low-level disk access using functions:
 *      _bios_disk          _dos_getdiskfree
 *
 */
 
#include &lt;stdio.h&gt;
#include &lt;conio.h&gt;
#include &lt;bios.h&gt;
#include &lt;dos.h&gt;
#include &lt;stdlib.h&gt;
 
char _far diskbuf[512];
 
void main( int argc, char *argv[] )
{
    unsigned status = 0, i;
    struct diskinfo_t di;
    struct diskfree_t df;
    unsigned char _far *p, linebuf[17];
 
    if( argc != 5 )
    {
        printf( "  SYNTAX: DISK &lt;driveletter&gt; &lt;head&gt; &lt;track&gt; &lt;sector&gt;" );
        exit( 1 );
    }
 
    if( (di.drive = toupper( argv[1][0] ) - 'A' ) &gt; 1 )
    {
        printf( "Must be floppy drive" );
        exit( 1 );
    }
    di.head     = atoi( argv[2] );
    di.track    = atoi( argv[3] );
    di.sector   = atoi( argv[4] );
    di.nsectors = 1;
    di.buffer   = diskbuf;
 
    /* Get information about disk size. */
    if( _dos_getdiskfree( di.drive + 1, &amp;df ) )
        exit( 1 );
 
    /* Try reading disk three times before giving up. */
    for( i = 0; i &lt; 3; i++ )
    {
        status = _bios_disk( _DISK_READ, &amp;di ) &gt;&gt; 8;
        if( !status )
            break;
    }
 
    /* Display one sector. */
    if( status )
        printf( "Error: 0x%.2x\n", status );
    else
    {
        for( p = diskbuf, i = 0; p &lt; (diskbuf + df.bytes_per_sector); p++ )
        {
            linebuf[i++] = (*p &gt; 32) ? *p : '.';
            printf( "%.2x ", *p );
            if( i == 16 )
            {
                linebuf[i] = '\0';
                printf( " %16s\n", linebuf );
                i = 0;
            }
        }
    }
    exit( 1 );
}
</pre>
</body>

</html>
