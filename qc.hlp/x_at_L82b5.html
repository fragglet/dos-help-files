<html>

<head>
<title>SETTIME.C - qc.hlp</title>
<link rel="stylesheet" href="../style.css">
<link rel="shortcut icon" href="../helpicon.png">
</head>

<body>
<div class="page-heading">
<form action="https://www.google.com/search" method="GET">
<input name="as_q" id="search-box" placeholder="Search">
<input type="hidden" name="as_sitesearch" value="dos-help.soulsphere.org/*">
</form>
qc.hlp (<a href='index.html'>Table of Contents</a>; <a href='TOPIC_LIST.html'>Topic list</a>)</div>
<div class="notice">
  <img src="../warning.png">
  <div class="heading">
    Important Notice
  </div>
  <div class="text">
    The pages on this site contain documentation for very old MS-DOS software,
    purely for historical purposes.

    If you're looking for up-to-date documentation, particularly for programming,
    you should not rely on the information found here, as it will be woefully
    out of date.
  </div>
</div>
<div class="page-title"> SETTIME.C</div>
<pre>                                             <span class='grhilite'>◄</span><a href='lib_dot_lst.html'>Up</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='index.html'>Contents</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='h_dot_index.html'>Index</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='javascript:history.back();'>Back</a><span class='grhilite'>►</span>
────────────────────────────────────────────────────────────────────────────
 
/* SETTIME.C illustates getting and setting the DOS time and date using:
 *      _dos_gettime    _dos_settime    _dos_getdate    _dos_setdate
 *
 * Formatted input to a string is illustrated using:
 *      sscanf
 *
 * See <a href='x_at_L82be.html'>TABLE.C</a> (fscanf) and <a href='x_at_L82b2.html'>SCANF.C</a> for other examples of formatted input.
 */
 
#include &lt;dos.h&gt;
#include &lt;stdio.h&gt;
#include &lt;conio.h&gt;
#include &lt;string.h&gt;
 
struct dosdate_t ddate;
struct dostime_t dtime;
 
void main()
{
    unsigned tmpday, tmpmonth, tmpyear;
    unsigned tmphour, tmpminute, tmpsecond;
    char *days[] = { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" };
    char tmpbuf[20];
 
    /* Get current date. */
    _dos_getdate( &amp;ddate );
    printf( "Date: %u/%02u/%02u %s\n",
            ddate.month, ddate.day, ddate.year - 1900,
            days[ddate.dayofweek] );
    printf( "Enter new date: " );
 
    /* Get a date string and if it's not 0 (for CR), assign it to date. */
    gets( tmpbuf );
    if( strlen( tmpbuf ) )
    {
        /* NOTE: You must read the month and day into a temporary unsigned
         * variable. If you try to read directly into the unsigned char
         * values ddate.day or ddate.month, sscanf (or scanf) will read a
         * word, thus overriding adjacent bytes.
         */
        sscanf( tmpbuf, "%u/%u/%u", &amp;tmpmonth, &amp;tmpday, &amp;tmpyear );
        if( (tmpyear - 80) &lt;= 20 )
            ddate.year = tmpyear + 1900;
        else if( (tmpyear &gt;= 1980) &amp;&amp; (tmpyear &lt;= 2099 ) )
            ddate.year = tmpyear;
        if( (tmpmonth + 1) &lt;= 13 )
            ddate.month = (unsigned char)tmpmonth;
        if( (tmpday + 1) &lt;= 32 )
            ddate.day = (unsigned char)tmpday;
        _dos_setdate( &amp;ddate );
        _dos_getdate( &amp;ddate );
        printf( "New date: %u/%02u/%02u %s\n",
                ddate.month, ddate.day, ddate.year - 1900,
                days[ddate.dayofweek] );
    }
 
    /* Get current time. */
    _dos_gettime( &amp;dtime );
    printf( "Time: %u:%02u:%02u\n", dtime.hour, dtime.minute, dtime.second );
    printf( "Enter new time: " );
 
    /* Get a time string and if it's not 0 (for CR), assign it to time. */
    gets( tmpbuf );
    if( strlen( tmpbuf ) )
    {
        sscanf( tmpbuf, "%u:%u:%u", &amp;tmphour, &amp;tmpminute, &amp;tmpsecond );
        if( tmphour &lt; 24 )
            dtime.hour = (unsigned char)tmphour;
        if( tmpminute &lt; 60 )
            dtime.minute = (unsigned char)tmpminute;
        if( tmpsecond &lt; 60 )
            dtime.second = (unsigned char)tmpsecond;
        _dos_settime( &amp;dtime );
        _dos_gettime( &amp;dtime );
        printf( "New time: %u:%02u:%02u\n",
                dtime.hour, dtime.minute, dtime.second );
    }
}
</pre>
</body>

</html>
