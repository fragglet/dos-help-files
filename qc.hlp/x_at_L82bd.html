<html>

<head>
<title>SYSINFO.C</title>
<link rel="stylesheet" href="../style.css">
</head>

<body>
<form action="https://duckduckgo.com/" method="GET">
<input name="q" id="search-box" placeholder="Search">
<input type="hidden" name="sites" value="fragglet.github.io">
</form>
<div class="page-title"> SYSINFO.C</div>
<pre>                                             <span class='grhilite'>◄</span><a href='lib_dot_lst.html'>Up</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='index.html'>Contents</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='h_dot_index.html'>Index</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='javascript:history.back();'>Back</a><span class='grhilite'>►</span>
────────────────────────────────────────────────────────────────────────────
 
/* SYSINFO.C illustrates miscellaneous DOS and BIOS status functions
 * including:
 *      _dos_getdrive       _dos_setdrive       _dos_getdiskfree
 *      _bios_memsize       _bios_equiplist     _bios_printer
 *
 * See <a href='x_at_L8289.html'>DISK.C</a> for another example of _dos_getdiskfree.
 *
 * Also illustrated:
 *      union               bitfield struct
 */
 
#include &lt;dos.h&gt;
#include &lt;bios.h&gt;
#include &lt;conio.h&gt;
#include &lt;stdio.h&gt;
#define LPT1 0
 
void main()
{
    struct diskfree_t drvinfo;
    unsigned drive, drivecount, memory, pstatus;
    union
    {                                   /* Access equiment either as:    */
        unsigned u;                     /*   unsigned or                 */
        struct                          /*   bit fields                  */
        {
            unsigned diskflag : 1;      /* Diskette drive installed?     */
            unsigned coprocessor : 1;   /* Coprocessor? (except on PC)   */
            unsigned sysram : 2;        /* RAM on system board           */
            unsigned video : 2;         /* Startup video mode            */
            unsigned disks : 2;         /* Drives 00=1, 01=2, 10=3, 11=4 */
            unsigned dma : 1;           /* 0=Yes, 1=No (1 for PC Jr.)    */
            unsigned comports : 3;      /* Serial ports                  */
            unsigned game : 1;          /* Game adapter installed?       */
            unsigned modem : 1;         /* Internal modem?               */
            unsigned printers : 2;      /* Number of printers            */
        } bits;
    } equip;
    char y[] = "YES", n[] = "NO";
 
    /* Get current drive. */
    _dos_getdrive( &amp;drive );
    printf( "Current drive:\t\t\t%c:\n", 'A' + drive - 1 );
 
    /* Set drive to current drive in order to get number of drives. */
    _dos_setdrive( drive, &amp;drivecount );
 
    _dos_getdiskfree( drive, &amp;drvinfo );
    printf( "Disk space free:\t\t%ld\n",
            (long)drvinfo.avail_clusters *
            drvinfo.sectors_per_cluster *
            drvinfo.bytes_per_sector );
 
    /* Get new drive and number of logical drives in system. */
    _dos_getdrive( &amp;drive );
    printf( "Number of logical drives:\t%d\n", drivecount );
 
    memory = _bios_memsize();
    printf( "Memory:\t\t\t\t%dK\n", memory );
 
    equip.u = _bios_equiplist();
 
    printf( "Disk drive installed:\t\t%s\n", equip.bits.diskflag ? y : n );
    printf( "Coprocessor installed:\t\t%s\n", equip.bits.coprocessor ? y : n );
    printf( "Game adapter installed:\t\t%s\n", equip.bits.game ? y : n );
    printf( "Serial ports:\t\t\t%d\n", equip.bits.comports );
    printf( "Number of printers:\t\t%d\n", equip.bits.printers );
 
    /* Fail if any error bit is on, or if either operation bit is off. */
    pstatus = _bios_printer( _PRINTER_STATUS, LPT1, 0 );
    if( (pstatus &amp; 0x29) || !(pstatus &amp; 0x80) || !(pstatus &amp; 0x10) )
        pstatus = 0;
    else
        pstatus = 1;
    printf( "Printer available:\t\t%s\n", pstatus ? y : n );
}
</pre>
</body>

</html>
