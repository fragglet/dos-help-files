<html>

<head>
<title>StrCompare - qa.hlp</title>
<link rel="stylesheet" href="../style.css">
<link rel="shortcut icon" href="../helpicon.png">
</head>

<body>
<div class="page-heading">
<form action="https://www.google.com/search" method="GET">
<input name="as_q" id="search-box" placeholder="Search">
<input type="hidden" name="as_sitesearch" value="fragglet.github.io/dos-help-files/*">
</form>
qa.hlp (<a href='index.html'>Table of Contents</a>; <a href='TOPIC_LIST.html'>Topic list</a>)</div>
<div class="page-title"> StrCompare</div>
<pre>   <span class='grhilite'>◄</span>Example<span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='javascript:history.back();'>Back</a><span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='index.html'>Contents</a><span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='ACTUALLY_NAMED_index.html'>Index</a><span class='grhilite'>►</span>
──────────────────────────────────────────────────────────────────────────────
 
;* StrCompare - Compares two strings for equality. See StrWrite, StrFindChar,
;* WinOpen, and WinClose procedures for other examples of string instructions.
;*
;* Shows:   Instructions - cmpsb     cmpsw     repe     test     jcxz
;*
;* Params:  str1 - Pointer to first string
;*          str2 - Pointer to second string
;*          len  - Length in bytes for comparison. Strings need not be of
;*                 equal length; however if len is an even number, comparison
;*                 is made on a word-by-word basis and thus is more efficient.
;*
;* Return:  Null pointer if strings match; else pointer to string #1 where
;*          match failed.
 
StrCompare PROC \
        USES ds di si, \
        str1:PTR BYTE, str2:PTR BYTE, len:WORD
 
        LoadPtr es, di, str1            ; ES:DI points to string #1
        LoadPtr ds, si, str2            ; DS:SI points to string #2
        mov     cx, len                 ; Length of search in bytes
        and     al, 0                   ; Set ZR flag in case CX = 0
        jcxz    nullp                   ; Assume success if length = 0
        test    cl, 1                   ; Even number?
        jz      wrdcmp                  ; Yes?  Compare word-by-word
        repe    cmpsb                   ; No?  Compare byte-by-byte
        jmp     SHORT nullp
 
wrdcmp: shr     cx, 1                   ; Decrease count by half
        repe    cmpsw                   ; Compare word-by-word
        sub     di, 2                   ; Back up 2 characters
        sub     si, 2
        cmpsb                           ; Match?
        jne     nullp                   ; No?  Then failure
        cmpsb                           ; Compare last characters
 
nullp:  mov     ax, 0                   ; Set null pointer without
        mov     dx, 0                   ;   disturbing flags
        je      exit                    ; If strings match, exit
        dec     di                      ; Else point to failure
        mov     ax, di
        mov     dx, es
exit:   ret
 
StrCompare ENDP
                                    -♦-
</pre>
</body>

</html>
