<html>

<head>
<title>Article Q49392 - vbdpss.hlp</title>
<link rel="stylesheet" href="../style.css">
<link rel="shortcut icon" href="../helpicon.png">
</head>

<body>
<div class="page-heading">
<form action="https://duckduckgo.com/" method="GET">
<input name="q" id="search-box" placeholder="Search">
<input type="hidden" name="sites" value="fragglet.github.io">
</form>
vbdpss.hlp (<a href='index.html'>Table of Contents</a>; <a href='TOPIC_LIST.html'>Topic list</a>)</div>
<div class="page-title"> Article Q49392</div>
<pre>                                                 <span class='grhilite'>◄</span><a href='../vbdos.hlp/blang_dot_contents.html'>Contents</a><span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='../vbdos.hlp/blang_dot_index.html'>Index</a><span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='javascript:history.back();'>Back</a><span class='grhilite'>►</span>
─────────────────────────────────────────────────────────────────────────────
                           <span class='grhilite'>◄</span><a href='index.html'>Knowledge Base Contents</a><span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='x_dot_a.html'>Knowledge Base Index</a><span class='grhilite'>►</span>
 
<b> Example of Passing User-Defined Type from Basic to MASM (Far)</b> - Q49392
 
 The two programs shown below demonstrate how a Microsoft Basic program
 passes a user-defined type to assembly language by far reference.
 
 More Information:
 
 The following Basic program is UFAR.BAS, which passes a user-defined
<b> type to assembly language by far reference.</b>
 
 Code Example
 ------------
 
 DEFINT A-Z
 DECLARE SUB MasmSub (BYVAL segment, BYVAL offset)
 
 TYPE mixed
    i AS INTEGER
    lng AS LONG
    s AS SINGLE
    d AS DOUBLE
    fx AS STRING * 19
 END TYPE
 
 DIM dummy AS mixed
 
 CLS
 PRINT "Calling assembly routine to fill the user-defined type."
 CALL MasmSub(VARSEG(dummy), VARPTR(dummy))
 PRINT "Values in user-defined type:"
 
 PRINT "Integer: ", dummy.i
 PRINT "Long: ", dummy.lng
 PRINT "Single: ", dummy.s
 PRINT "Double: ", dummy.d
 PRINT "fixed-length String: ", dummy.fx
 
 END
 
 The following program is UAFAR.ASM, which gets a user-defined type by
<b> far reference and copies data into it:</b>
 
 .MODEL MEDIUM
         usrdefType STRUC
                    iAsm  DW 10
                    lAsm  DD 43210
                    sAsm  DD 32.10
                    dAsm  DQ 12345.67
                    fxAsm DB 'Fixed-length string'
         usrdefType ENDS
 .DATA
         AsmRec usrdefType &lt;&gt;
 
         PUBLIC MasmSub
 MasmSub PROC FAR
         push bp
         mov  bp,sp
         push es
         push di
         push si
         push cx
 
         mov es,[bp+8]         ; Get segment of user-defined type.
         mov di,[bp+6]         ; Get offset of user-defined type.
         mov si,OFFSET AsmRec
         mov cx,37             ; Size of structure.
         rep movsb             ; Copy values to Basic variable.
 
         pop cx
         pop si
         pop di
         pop es
         pop bp
         ret 4
 MasmSub ENDP
         END
 
 To demonstrate these programs from an .EXE program, compile and link
<b> as follows:</b>
 
      BC /O UFAR.BAS;
      MASM UAFAR.ASM;
      LINK UFAR UAFAR;
 
 UFAR.EXE produces the following output:
 
      Integer:   10
      Long:      43210
      Single:    32.1
      Double     12345.67
      fixed-length String:  Fixed-length string
</pre>
</body>

</html>
