<html>

<head>
<title>VARPTR, VARSEG Functions Programming Example</title>
<link rel="stylesheet" href="../style.css">
</head>

<body>
<pre>
                       <span class='grhilite'>◄</span>Example<span class='grhilite'>►</span>                 <span class='grhilite'>◄</span><a href='unknown#-9996'>Contents</a><span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='unknown#-9997'>Index</a><span class='grhilite'>►</span>  <span class='grhilite'>◄</span><a href='javascript:history.back();'>Back</a><span class='grhilite'>►</span>
──────────────────────────────────────────────────────────────────────────────
'This example uses the VARPTR and VARSEG functions in a CALL statement
'to pass a BASIC array to a C function.
 
'Note: To run this program, you must separately compiled the C function
'with the large-model (/AL) switch and place the object module in a
'Quick library or link it to the BASIC program.
 
DEFINT A-Z
DECLARE SUB AddArr CDECL (BYVAL Offs, BYVAL Segm, BYVAL Num)
DIM A(1 TO 100) AS INTEGER
'Fill the array with the numbers 1 to 15.
FOR I = 1 TO 15
   A(I) = I
NEXT I
 
'Call the C function. AddArr expects a far address (segment and offset).
'Because CDECL puts things on the stack from right to left, put the offset,
'VARPTR(A(1)), first in the list, followed by the segment, VARSEG(A(1)).
 
CALL AddArr(VARPTR(A(1)), VARSEG(A(1)), 15)
 
'Print the modified array.
FOR I = 1 TO 15
   PRINT A(I)
NEXT I
END
 
 
'/* C Function AddArr */
'/* Add one to the first num elements of array arr.*/
'void far addarr(arr,num)
'int far *arr;
'int num;
'{
'    int i;
'    for(i=0;i&lt;num;i++) arr[i]++;
'}

</pre>
</body>

</html>
