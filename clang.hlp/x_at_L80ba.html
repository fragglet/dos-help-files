<html>

<head>
<title>DOSMEM.C - C Language and Libraries Help</title>
<link rel="stylesheet" href="../style.css">
</head>

<body>
<div class="page-title"> DOSMEM.C - C Language and Libraries Help</div>
<pre>                                             <span class='grhilite'>◄</span><a href='x_at_L8122.html'>Up</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='../advisor.hlp/hv.html'>Contents</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='../advisor.hlp/vx.html'>Index</a><span class='grhilite'>►</span> <span class='grhilite'>◄</span><a href='javascript:history.back();'>Back</a><span class='grhilite'>►</span>
─────Run-Time Library───────────────────────────────────────────────────────
 
/* DOSMEM.C illustrates functions:
 *      _dos_allocmem       _dos_setblock       _dos_freemem      (DOS-only)
 *
 * See <a href='x_at_L80b5.html'>COPY2.C</a> for another example of _dos_allocmem and _dos_freemem.
 */
 
#include &lt;dos.h&gt;
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
 
void main()
{
    char __far *buf = NULL, __far *p;
    unsigned segbuf, maxbuf, size = 512;
 
    /* Allocate 512-byte buffer. Convert the size to paragraphs.
     * Assign the segment to the buffer. Fill with A's.
     */
    if( _dos_allocmem( size &gt;&gt; 4, &amp;segbuf ) )
        exit( 1 );
    _FP_SEG( buf ) = segbuf;
    for( p = buf; p &lt; (buf + size); p++ )
        *p = 'A';
 
    /* Double the allocation. Fill the second half with B's. */
    size *= 2;
    if( _dos_setblock( size &gt;&gt; 4, segbuf, &amp;maxbuf ) )
        exit( 1 );
    _FP_SEG( buf ) = segbuf;
    for( p = buf + (size / 2); p &lt; (buf + size); p++ )
        *p = 'B';
    *(--p) = '\0';
 
    printf( "Memory available: %u paragraphs\n", maxbuf );
    printf( "Buffer at %Fp contains:\n%Fs", (int __far *)buf, buf );
 
    /* Free memory */
    exit( !_dos_freemem( segbuf ) );
}
                                    -♦-
</pre>
</body>

</html>
